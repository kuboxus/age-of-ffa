<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Age of War: Multiplayer</title>
    
    <!-- Firebase Imports -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="absolute top-2 left-2 z-50">
    <a href="offline.html" class="text-gray-400 hover:text-white text-xs underline">Play Offline</a>
</div>

<!-- === UI LAYOUT === -->
<div id="lobby-screen" class="screen flex flex-col md:flex-row items-center justify-center relative bg-gradient-to-br from-gray-900 via-purple-900 to-black gap-8 p-4">
    <div class="absolute bottom-4 right-4 text-gray-400 text-sm z-10">Build: <span id="version-display"></span></div>

    <!-- MAIN MENU PANEL -->
    <div class="glass-panel p-8 rounded-xl max-w-md w-full text-center z-10 shadow-2xl border-2 border-gray-700">
        <h1 class="text-5xl font-bold mb-6 text-yellow-500">Age of War</h1>
        <div id="auth-status" class="mb-6 text-base text-yellow-500 animate-pulse">Connecting...</div>

        <div class="flex flex-col gap-4">
            <input id="lobby-name" type="text" placeholder="Your Name" class="bg-gray-800 border border-gray-600 p-4 rounded text-white text-xl">
            <div class="flex items-center gap-4 bg-gray-800 p-3 rounded border border-gray-600">
                <span class="text-lg text-gray-300">Base Color:</span>
                <input id="player-color" type="color" value="#ff0000" class="flex-1">
            </div>
            <div class="flex items-center gap-3 justify-center text-gray-400 mb-2 bg-gray-800 p-2 rounded border border-gray-600">
                 <label for="is-private-lobby" class="cursor-pointer text-gray-300 select-none">Private Game</label>
                 <input type="checkbox" id="is-private-lobby" class="toggle-checkbox">
            </div>
            <button onclick="Network.createLobby()" class="btn-primary w-full py-4 text-xl">Create New Game</button>
            <div class="flex gap-2 mt-4">
                <input id="lobby-id-input" type="text" placeholder="CODE" class="bg-gray-800 border border-gray-600 p-3 rounded flex-1 text-white text-base text-center uppercase tracking-widest">
                <button onclick="Network.joinLobby()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 rounded font-bold text-lg">Join</button>
            </div>
        </div>
    </div>
    
    <!-- PUBLIC BROWSER PANEL -->
    <div class="glass-panel p-6 rounded-xl w-80 h-96 flex flex-col z-10 shadow-2xl border-2 border-gray-700 bg-opacity-80">
        <h2 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-600 pb-2">Public Games</h2>
        <div id="active-lobbies-list" class="flex-1 overflow-y-auto pr-2">
            <div class="text-gray-500 text-sm text-center mt-10">Loading...</div>
        </div>
    </div>
</div>

<div id="waiting-room" class="screen hidden w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-black p-6 overflow-hidden">
    <div class="flex flex-col md:flex-row gap-6 w-full max-w-6xl h-full max-h-[800px]">
        
        <!-- LEFT: Player List -->
        <div class="glass-panel p-6 rounded-xl flex-1 flex flex-col min-w-[300px]">
            <h2 class="text-3xl font-bold mb-2">Lobby</h2>
            <div id="copy-box" class="bg-black p-3 rounded mb-4 text-sm font-mono text-gray-400 cursor-pointer transition flex justify-between items-center" onclick="copyLobbyId()">
                <span>Code: <span id="display-lobby-id" class="text-white font-bold select-all text-lg tracking-widest"></span></span>
                <span class="text-xs bg-gray-700 px-2 py-1 rounded">COPY</span>
            </div>
            <div class="mb-4 flex-1 overflow-hidden flex flex-col">
                <h3 class="text-lg text-gray-400 mb-2">Players</h3>
                <div id="player-list" class="flex-1 overflow-y-auto pr-2 text-base"></div>
            </div>
            <div class="flex gap-2 mb-2">
                <button id="add-bot-btn" onclick="Network.addBot()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-3 rounded flex-1">Add Bot</button>
                <button id="start-btn" onclick="Network.setGameStarted()" class="btn-primary flex-1 text-xl">Start Game</button>
            </div>
            <button onclick="Network.leaveLobby()" class="text-red-500 hover:text-red-400 text-sm underline text-center mt-2">Leave Lobby</button>
        </div>

        <!-- RIGHT: Settings -->
        <div id="settings-panel" class="glass-panel p-6 rounded-xl flex-1 flex-col min-w-[300px] overflow-y-auto flex">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-200">Game Settings</h2>
                <!-- resetSettings was simple logic, can be added to Network or UI, skipping for brevity or assume manual reset -->
                <button id="reset-btn" onclick="Network.updateLobbySettings()" class="text-xs text-yellow-500 hover:text-yellow-400 underline hidden">Save/Update</button> 
            </div>

            <!-- Mode Selector -->
            <div class="mb-6">
                <label class="block text-gray-400 text-sm mb-1">Game Mode</label>
                <select id="set-mode" onchange="Network.updateLobbySettings()" class="w-full bg-gray-800 border border-gray-600 p-2 rounded text-white">
                    <option value="FFA">Free For All</option>
                    <option value="TEAMS">Team vs Team (2 Teams)</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">Teams share victory. No friendly fire.</p>
            </div>
            
            <div class="team-only hidden mb-6">
                 <label class="block text-gray-400 text-sm mb-1">Map Layout</label>
                 <select id="set-layout" onchange="Network.updateLobbySettings()" class="w-full bg-gray-800 border border-gray-600 p-2 rounded text-white">
                     <option value="alternating">Checkerboard (T1, T2, T1...)</option>
                     <option value="together">Together (T1s vs T2s)</option>
                 </select>
            </div>

            <!-- Sliders -->
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>Game Speed</span><span id="val-speed" class="text-yellow-400">1.0x</span></div>
                    <input id="set-speed" type="range" min="0.5" max="3.0" step="0.1" value="1.0" oninput="Network.updateLobbySettings()">
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>Unit Cost</span><span id="val-cost" class="text-yellow-400">1.0x</span></div>
                    <input id="set-cost" type="range" min="0.1" max="5.0" step="0.1" value="1.0" oninput="Network.updateLobbySettings()">
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>Gold Reward</span><span id="val-gold" class="text-yellow-400">1.0x</span></div>
                    <input id="set-gold" type="range" min="0.5" max="5.0" step="0.1" value="1.0" oninput="Network.updateLobbySettings()">
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>XP Reward</span><span id="val-xp" class="text-yellow-400">1.0x</span></div>
                    <input id="set-xp" type="range" min="0.5" max="5.0" step="0.1" value="1.0" oninput="Network.updateLobbySettings()">
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>XP to Level Up</span><span id="val-xpreq" class="text-yellow-400">1.0x</span></div>
                    <input id="set-xpreq" type="range" min="0.1" max="2.0" step="0.1" value="1.0" oninput="Network.updateLobbySettings()">
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1"><span>Base HP</span><span id="val-hp" class="text-yellow-400">2500</span></div>
                    <input id="set-hp" type="range" min="500" max="10000" step="500" value="2500" oninput="Network.updateLobbySettings()">
                </div>
            </div>
        </div>
    </div>
</div>

<div id="game-screen" class="screen hidden w-full h-full">
    <canvas id="game-canvas"></canvas>
    <div id="connection-overlay" class="absolute inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
        <div class="glass-panel p-8 rounded-xl text-center"><h2 class="text-3xl font-bold text-red-500 mb-2">Connection Lost</h2><p class="text-gray-300">Waiting for Host...</p></div>
    </div>
    <div class="game-ui flex flex-col justify-between p-6">
        <div class="flex justify-between items-start w-full">
            <div class="glass-panel p-4 rounded flex gap-6 text-base pointer-events-auto items-center">
                <div class="flex flex-col"><span class="text-yellow-400 font-bold text-lg">GOLD</span><span id="stats-gold" class="text-3xl">0</span></div>
                <div class="flex flex-col border-l border-gray-600 pl-6"><span class="text-blue-400 font-bold text-lg">XP</span><span id="stats-xp" class="text-3xl">0</span></div>
                <div class="border-l border-gray-600 pl-6 cursor-pointer text-2xl" id="mute-btn" onclick="AudioManager.toggleMute()">ðŸ”Š</div>
            </div>
            <div id="target-status" class="glass-panel px-6 py-3 rounded font-bold text-red-400 animate-pulse text-xl pointer-events-auto">Select Target</div>
            <div class="glass-panel p-3 rounded pointer-events-auto"><button id="upgrade-btn" class="btn-primary text-lg hidden p-4">Evolve</button></div>
        </div>
        <div class="flex flex-col items-center gap-4 pb-6 w-full">
            <div class="flex items-end gap-6">
                <button id="special-btn" class="relative w-24 h-24 rounded bg-purple-900 border-2 border-purple-500 hover:bg-purple-800 flex flex-col items-center justify-center transition overflow-hidden pointer-events-auto">Locked</button>
                <div id="unit-bar" class="flex gap-4 glass-panel p-4 rounded-xl pointer-events-auto"></div>
            </div>
            <div id="queue-bar" class="flex gap-2 mb-2 h-[45px] pointer-events-auto"></div>
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script src="js/common/constants.js"></script>
<script src="js/common/state.js"></script>
<script src="js/common/utils.js"></script>
<script src="js/common/audio-manager.js"></script>
<script src="js/engine/game-logic.js"></script>
<script src="js/engine/renderer.js"></script>
<script src="js/ui/ui-manager.js"></script>
<script src="js/network/p2p-manager.js"></script>
<script src="js/network/firebase-adapter.js"></script>
<script src="js/main-online.js"></script>

</body>
</html>
